<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<!-- namespace: 해당 mapper파일의 고유한 별칭 -->
<mapper namespace="csMapper">
	<!-- 내 정보로 이동할 때 이미지 파일 가지고있는지 확인하기 위한 resultMapper -->
	<resultMap type="Cs" id="selectCs">
		<result column="BOARD_NO" property="boardNo"/>
		<result column="NICKNAME" property="nickname"/>
		<result column="USER_NO" property="userNo"/>
		<result column="BOARD_LEVEL" property="boardLevel"/>
		<result column="WRITE_DATE" property="writeDate"/>
		<result column="BOARD_TITLE" property="boardTitle"/>
		<result column="BOARD_CONTENTS" property="boardContents"/>
		<result column="BOARD_COUNT" property="boardCount"/>
		<result column="STATUS" property="status"/>
	</resultMap>
	<resultMap type="Cs" id="csResult">
		<result column="BOARD_NO" property="boardNo"/>
		<result column="NICKNAME" property="nickname"/>
		<result column="USER_NO" property="userNo"/>
		<result column="BOARD_LEVEL" property="boardLevel"/>
		<result column="WRITE_DATE" property="writeDate"/>
		<result column="BOARD_TITLE" property="boardTitle"/>
		<result column="BOARD_CONTENTS" property="boardContents"/>
		<result column="BOARD_COUNT" property="boardCount"/>
		<result column="STATUS" property="status"/>
	</resultMap>
	<resultMap type="Reply" id="replyResult">
		<result column="BOARD_REPLY_NO" property="boardReplyNo"/>
		<result column="NICKNAME" property="nickname"/>
		<result column="BOARD_NO" property="boardNo"/>
		<result column="REPLY_CONTENTS" property="replyContents"/>
		<result column="REPLY_DATE" property="replyDate"/>
		<result column="REPLY_DIBS" property="replyDibs"/>
		<result column="STATUS" property="status"/>
	</resultMap>
	<resultMap type="ThumbUp" id="ThumbUpResult">
		<result column="BOARD_NO" property="boardNo"/>
		<result column="USER_NO" property="userNo"/>
	</resultMap>

	<select id="selectListCount" resultType="_int">
		SELECT	COUNT(*)
		FROM	BOARD
		WHERE	BOARD_LEVEL = #{boardLevel}
		AND		STATUS = 'Y'
	</select>
	<select id="selectList" resultMap="csResult">
		SELECT	BOARD_NO,
			  	BOARD_TITLE,
			  	NICKNAME,
			  	TO_CHAR(WRITE_DATE, 'YYYY-MM-DD') AS "WRITE_DATE",
			  	BOARD_COUNT,
			  	BOARD_LEVEL
		FROM	BOARD B
		JOIN	MEMBER USING (USER_NO)
		WHERE	STATUS = 'Y'
		AND		BOARD_LEVEL = #{boardLevel}
		ORDER	BY BOARD_NO DESC
	</select>
	<select id="searchListCount" resultType="_int">
		SELECT	COUNT(*)
		FROM	BOARD
		JOIN	MEMBER USING (USER_NO)
		WHERE	BOARD_LEVEL = CAST(#{boardLevel} AS INTEGER)
		AND		STATUS = 'Y'
		<if test="condition == 'writer'">
		 	AND	NICKNAME
		</if>
		<if test="condition == 'title'">
		 	AND	BOARD_TITLE
		</if>
		LIKE '%' || #{keyword} || '%'
	</select>
	<select id="searchList" resultMap="csResult">
		SELECT	BOARD_NO,
			  	BOARD_TITLE,
			  	NICKNAME,
			  	TO_CHAR(WRITE_DATE, 'YYYY-MM-DD') AS "WRITE_DATE",
			  	BOARD_COUNT,
			  	BOARD_LEVEL
		FROM	BOARD
		JOIN	MEMBER USING (USER_NO)
		WHERE	STATUS = 'Y'
		<if test="condition == 'writer'">
		 	AND	NICKNAME
		</if>
		<if test="condition == 'title'">
		 	AND	BOARD_TITLE
		</if>
		LIKE '%' || #{keyword} || '%'
		AND		BOARD_LEVEL = CAST(#{boardLevel} AS INTEGER)
		ORDER BY BOARD_NO DESC
	</select>
	<update id="increaseCount">
		UPDATE BOARD
		SET		BOARD_COUNT = BOARD_COUNT + 1
		WHERE	BOARD_NO = #{boardNo}
		AND		STATUS = 'Y'
	</update>
	<select id="selectBoard" resultMap="csResult">
		SELECT	BOARD_NO,
				BOARD_TITLE,
				NICKNAME,
				USER_NO,
				BOARD_LEVEL,
				BOARD_CONTENTS,
				BOARD_COUNT,
				TO_CHAR(WRITE_DATE, 'YYYY-MM-DD') AS "WRITE_DATE"
		FROM	BOARD
		JOIN	MEMBER USING (USER_NO)
		WHERE	STATUS = 'Y'
		AND		BOARD_NO = #{boardNo}
	</select>
	<select id="selectReply" resultMap="replyResult">
		SELECT	BOARD_REPLY_NO,
				NICKNAME,
				REPLY_CONTENTS,
				TO_CHAR(REPLY_DATE, 'YYYY-MM-DD') AS "REPLY_DATE",
				REPLY_DIBS
		FROM	BOARD_REPLY
		JOIN	MEMBER USING(USER_NO)
		WHERE	STATUS = 'Y'
		AND		BOARD_NO = #{bno}
		ORDER BY BOARD_REPLY_NO DESC
	</select>
	

</mapper>